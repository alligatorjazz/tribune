<head>
	<meta charset="UTF-8">
	<meta content="width=device-width, initial-scale=1.0" name="viewport">
	<title>Tribune - Home</title>
	<link href="/styles/core.css" rel="stylesheet">
	<link rel="stylesheet" href="/styles/index.css">
	<link href="https://fonts.googleapis.com" rel="preconnect">
	<link href="https://fonts.gstatic.com" crossorigin="" rel="preconnect">
	<link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&amp;family=Playfair+Display:ital,wght@0,400..900;1,400..900&amp;display=swap" rel="stylesheet">
</head>
<body>

	<nav-bar></nav-bar>
	<main>
		<div id="major-story">
			<h1><span>TRIBUNE</span> <span>GOES LIVE!</span></h1>
			<h2>A Web Development Tool Intended For Amateur Designers</h2>
			<p>Tribune seeks to provide a few quality-of-life features to speed up the process of designing and blogging
				on Neocities - or any static site hosting provider of your choice.
			</p>
			<button>Get Started</button>
		</div>
		<div id="features-header">
			<h1>Key Features!</h1>
		</div>
		<div class="feature">
			<h2>No Installation!</h2>
			<p>Just drop the (mercifully tiny) Tribune executable in your site folder and run - it'll build your site
				for
				you with (almost) no fuss! Tribune is and will always remain totally portable.</p>
		</div>
		<div class="feature">
			<h2>Markdown Support!</h2>
			<p>Write your blog posts in markdown and have them auto-compile into HTML files! You can apply custom
				stylesheets to your articles as you please.</p>
		</div>
		<div class="feature">
			<h2>Reusable Widgets!</h2>
			<p>Using native web components, build reusable building blocks for your entire site just by writing normal,
				god-fearing HTML - no Javascript required (on your end, at least).</p>
		</div>
		<div class="feature">
			<h2>RSS Feed Generation!</h2>
			<p>Using just a folder of some markdown files, some frontmatter, and a dream, Tribune can create an RSS feed
				for
				your blog so everyone can keep up with your legendary posts.</p>
		</div>
	</main>




<script>const tribune_data = {
	posts: []
};

function isSameOrigin(urlString) {
    const url = new URL(urlString);
    const currentUrl = new URL(window.location.href);
    return (url.origin === currentUrl.origin);
}


tribune_data.posts["test"] = {"title":"gay peo","publish_date":"04/25/2001","description":"weeee","template":"default","tags":null}

function buildWidget(tag, path, inheritFrom) {
	const AquilaWidget = class extends HTMLElement {
		container;
		constructor() {
			super();
			this.container = document.createElement(inheritFrom ?? "div");
			this.container.style.visibility = "hidden"
			if (!path.startsWith("/")) {
				throw new Error("You can only load widgets from your own site for security reasons.");
			}

			if (!path.endsWith(".html")) {
				throw new Error("Widgets have to be html files.");
			}

			// load content
			fetch(path).then(res => {
				res
					.text()
					.then(text => {
						this.container.innerHTML = text
					})
					.catch(err => console.error(err))
					.finally(() => this.container.style.visibility = "visible")
			})
		}
		connectedCallback() {
			this.appendChild(this.container);
		}
	}
	customElements.define(tag, AquilaWidget)
}


function include(...elements) {
	for (const { tag, path } of elements) {
		if (tag === "blog-post") {
			// TODO: docs link here
			console.error("Sorry! You can't make a widget called blog-post - that's a reserved name. Check the docs for more details!")
		} else {
			buildWidget(tag, path)
		}
	}
}

class PostList extends HTMLElement {
	container;
	constructor() {
		// TODO: custom attribute for filtering by tag
		super();
		this.container = document.createElement("ul");
		Object.entries(tribune_data.posts).map(([slug, data]) => {
			let content = document.createElement("a");
			content.href = "/posts/" + slug;

			if (data.title) {
				let title = document.createElement("div");
				title.className = "title";
				title.innerHTML = data.title;
				content.appendChild(title);
			}

			if (data.publish_date) {
				let date = document.createElement("div");
				date.className = "date";
				date.innerHTML = new Date(data.publish_date).toDateString();
				content.appendChild(date);
			}

			if (data.description) {
				let description = document.createElement("div");
				description.className = "description";
				description.innerHTML = data.description;
				content.appendChild(description);
			}

			this.container.appendChild(content);
		})
	}
	connectedCallback() {
		this.appendChild(this.container);
	}
}

customElements.define("post-list", PostList)

include({tag: 'site-footer', path: '/widgets/site-footer.html'})
include({tag: 'nav-bar', path: '/widgets/nav-bar.html'})
include({tag: 'one-word', path: '/widgets/one-word.html'})</script>
</body>